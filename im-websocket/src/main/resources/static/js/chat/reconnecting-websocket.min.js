!function(a,b){"function"==typeof define&&define.amd?define([],b):"undefined"!=typeof module&&module.exports?module.exports=b():a.ReconnectingWebSocket=b()}(this,function(){function a(b,c,d){function e(a,b){var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,!1,!1,b),c}var g,h,i,j,k,l,f={debug:!1,automaticOpen:!0,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3,isReconnect:!0};d||(d={});for(g in f)this[g]="undefined"!=typeof d[g]?d[g]:f[g];this.url=b,this.reconnectAttempts=0,this.readyState=WebSocket.CONNECTING,this.protocol=null,i=this,j=!1,k=!1,l=document.createElement("div"),l.addEventListener("open",function(a){i.onopen(a)}),l.addEventListener("close",function(a){i.onclose(a)}),l.addEventListener("connecting",function(a){i.onconnecting(a)}),l.addEventListener("message",function(a){i.onmessage(a)}),l.addEventListener("error",function(a){i.onerror(a)}),this.addEventListener=l.addEventListener.bind(l),this.removeEventListener=l.removeEventListener.bind(l),this.dispatchEvent=l.dispatchEvent.bind(l),this.open=function(b){h=new WebSocket(i.url,c||[]),b||l.dispatchEvent(e("connecting")),(i.debug||a.debugAll)&&console.debug("ReconnectingWebSocket","attempt-connect",i.url);var d=h,f=setTimeout(function(){(i.debug||a.debugAll)&&console.debug("ReconnectingWebSocket","connection-timeout",i.url),k=!0,d.close(),k=!1},i.timeoutInterval);h.onopen=function(){clearTimeout(f),(i.debug||a.debugAll)&&console.debug("ReconnectingWebSocket","onopen",i.url),i.protocol=h.protocol,i.readyState=WebSocket.OPEN,i.reconnectAttempts=0;var c=e("open");c.isReconnect=b,b=!1,l.dispatchEvent(c)},h.onclose=function(c){var d,f;clearTimeout(f),h=null,j?(i.readyState=WebSocket.CLOSED,l.dispatchEvent(e("close"))):(i.readyState=WebSocket.CONNECTING,d=e("connecting"),d.code=c.code,d.reason=c.reason,d.wasClean=c.wasClean,l.dispatchEvent(d),b||k||((i.debug||a.debugAll)&&console.debug("ReconnectingWebSocket","onclose",i.url),l.dispatchEvent(e("close"))),f=i.reconnectInterval*Math.pow(i.reconnectDecay,i.reconnectAttempts),1==i.isReconnect&&setTimeout(function(){i.reconnectAttempts++,i.open(!0)},f>i.maxReconnectInterval?i.maxReconnectInterval:f))},h.onmessage=function(b){(i.debug||a.debugAll)&&console.debug("ReconnectingWebSocket","onmessage",i.url,b.data);var c=e("message");c.data=b.data,l.dispatchEvent(c)},h.onerror=function(b){(i.debug||a.debugAll)&&console.debug("ReconnectingWebSocket","onerror",i.url,b),l.dispatchEvent(e("error"))}},1==this.automaticOpen&&this.open(!1),this.send=function(b){if(h)return(i.debug||a.debugAll)&&console.debug("ReconnectingWebSocket","send",i.url,b),h.send(b);throw"INVALID_STATE_ERR : Pausing to reconnect websocket"},this.close=function(a,b){"undefined"==typeof a&&(a=1e3),j=!0,h&&h.close(a,b)},this.refresh=function(){h&&h.close()}}return a.prototype.onopen=function(){},a.prototype.onclose=function(){},a.prototype.onconnecting=function(){},a.prototype.onmessage=function(){},a.prototype.onerror=function(){},a.debugAll=!1,a.CONNECTING=WebSocket.CONNECTING,a.OPEN=WebSocket.OPEN,a.CLOSING=WebSocket.CLOSING,a.CLOSED=WebSocket.CLOSED,a});